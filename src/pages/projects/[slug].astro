---
import BaseLayout from '@/layouts/BaseLayout.astro';
import {
  ProjectScreen,
  getTranslatedProjects,
  type TranslatedProject,
} from '@/features/projects';
import { ui, type LanguageCode, defaultLanguage, languages } from '@/i18n/ui';

export async function getStaticPaths() {
  const currentLocale = Astro.currentLocale as LanguageCode | undefined;
  const lang =
    currentLocale && Object.hasOwn(languages, currentLocale)
      ? currentLocale
      : defaultLanguage;
  const paths = [];

  const projects = getTranslatedProjects(lang);
  for (const project of projects) {
    paths.push({
      params: { slug: project.slug },
      props: { project },
    });
  }
  return paths;
}
const currentLocale = Astro.currentLocale as LanguageCode | undefined;
const lang =
  currentLocale && Object.hasOwn(languages, currentLocale)
    ? currentLocale
    : defaultLanguage;
const { project } = Astro.props as { project: TranslatedProject };

const t = ui[lang] ?? ui[defaultLanguage];

if (!project) {
  return Astro.redirect('/404');
}

const pageTitle = `${project.title} | ${t.site.title}`;
const pageDescription = project.detailedDescription ?? project.description;
---

<BaseLayout pageTitle={pageTitle} pageDescription={pageDescription}>
  <ProjectScreen project={project} t={t} />
</BaseLayout>
