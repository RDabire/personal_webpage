---
import { PortfolioScreen } from '@/features/projects';
import { defaultLanguage, useTranslations, type LanguageCode } from '@/i18n/ui';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

const lang =
  (Astro.currentLocale as LanguageCode | undefined) ?? defaultLanguage;
const t = useTranslations(lang, 'homePage');

const pageTitle = t('pageTitle');
const pageDescription = t('pageDescription');

const blogEntries: Array<CollectionEntry<'blog'>> = await getCollection(
  'blog',
  ({ data }) => data.isDraft !== true && data.lang === defaultLanguage
);

blogEntries.sort(
  (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
);

const writingPreviews = blogEntries.slice(0, 3).map((entry) => {
  const slugSegments = entry.id.split('/');
  const slug =
    slugSegments.length > 1
      ? slugSegments.slice(1).join('/')
      : slugSegments[0];

  return {
    slug,
    title: entry.data.title,
    description: entry.data.description,
    pubDate: entry.data.pubDate,
    heroImage: entry.data.heroImage?.url,
    heroImageAlt: entry.data.heroImage?.alt,
  };
});
---

<BaseLayout pageTitle={pageTitle} pageDescription={pageDescription}>
  <PortfolioScreen lang={lang} writingPreviews={writingPreviews} />
</BaseLayout>
