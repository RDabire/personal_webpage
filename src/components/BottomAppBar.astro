---
import { cn } from '@/lib/utils';
import ThemeToggle from './ThemeToggle.astro';

import type { NavItem } from '@/layouts/BaseLayout.astro';

const currentPathname = Astro.url.pathname;

export interface Props {
  navItems: NavItem[];
}

const { navItems } = Astro.props;
---

<nav
  class="md:hidden fixed bottom-0 left-0 z-50 w-full bg-background p-2 border-t border-border"
  role="navigation"
  aria-label="Main navigation"
>
  <div
    class:list={[
      'flex h-16 max-w-screen-sm mx-auto justify-between items-center',
    ]}
  >
    {
      navItems.map((item) => {
        const normalizedHref = item.href.replace(/\/$/, '') || '/';
        const normalizedPath = currentPathname.replace(/\/$/, '') || '/';

        let isActive = normalizedPath === normalizedHref;
        if (
          normalizedHref !== '/' &&
          normalizedPath.startsWith(`${normalizedHref}/`)
        ) {
          isActive = true;
        }

        const Icon = item.icon;
        const title = item.label;

        return (
          <a
            href={item.href}
            aria-label={title}
            aria-current={isActive ? 'page' : undefined}
            class={cn(
              'relative flex flex-col items-center justify-center transition-colors duration-200 w-full',
              isActive
                ? 'text-primary font-semibold'
                : 'text-muted-foreground hover:text-foreground'
            )}
            style="min-width: 48px; min-height: 48px;"
          >
            <span
              class={cn(
                'flex items-center justify-center rounded-full transition bg-transparent',
                isActive ? 'bg-primary/10' : ''
              )}
              style="width: 36px; height: 36px;"
            >
              <Icon class="size-5" />
            </span>
            <span class="text-[10px] truncate max-w-[90%] text-center leading-tight">
              {title}
            </span>
            {isActive && (
              <span class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-6 h-1 rounded-full bg-primary" />
            )}
          </a>
        );
      })
    }
    {/* Theme Toggle Button */}
    <div class="flex items-center gap-x-3">
      <ThemeToggle />
    </div>
  </div>
</nav>
