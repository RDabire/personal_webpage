---
import type { LanguageCode } from '@/i18n/ui';
import { useTranslations } from '@/i18n/ui';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { formatDate } from '@/lib/utils';
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { ArrowLeft, Clock } from 'lucide-react';
import BlogPostCard from '../components/BlogPostCard.astro';

type Props = {
  post: CollectionEntry<'blog'>['data'];
  lang: LanguageCode;
  relatedPosts: Array<CollectionEntry<'blog'>>;
};

const { post, lang, relatedPosts } = Astro.props;

const pubDate = new Date(post.pubDate);
const updatedDate = post.updatedDate ? new Date(post.updatedDate) : null;

const t = useTranslations(lang, 'blogPost');

const pageTitle = post.title;
const pageDescription = post.description;
---

<BaseLayout {pageTitle} {pageDescription}>
  <article class="content-shell">
    <header class="page-intro max-w-3xl">
      <a
        href="/blog"
        class="mb-7 inline-flex items-center gap-2 text-sm font-semibold text-muted-foreground hover:text-foreground"
      >
        <ArrowLeft class="size-4" />
        {t('backToList')}
      </a>

      <h1 class="headline-display max-w-3xl">
        {post.title}
      </h1>

      <div
        class="mt-6 flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.12em] text-muted-foreground"
      >
        <span>{t('publishedOn')} {formatDate(pubDate, lang)}</span>
        {
          updatedDate && (
            <span>
              {t('updatedOn')} {formatDate(updatedDate, lang)}
            </span>
          )
        }
        <span class="inline-flex items-center gap-1">
          <Clock class="size-3.5" />
          {post.readingTimeMinutes}
          {t('readingTimeSuffix')}
        </span>
      </div>

      {
        post.tags && post.tags.length > 0 && (
          <div class="mt-6 flex flex-wrap gap-2">
            {post.tags.map((tag: string) => (
              <span class="rounded-full border border-border bg-muted/65 px-3 py-1 text-[0.68rem] uppercase tracking-[0.12em] text-muted-foreground">
                {tag}
              </span>
            ))}
          </div>
        )
      }

      {
        post.heroImage && (
          <div class="mt-8 max-w-3xl overflow-hidden rounded-2xl border border-border/80 bg-muted/40">
            <Image
              src={post.heroImage.url}
              alt={post.heroImage.alt}
              width={1080}
              height={620}
              class="max-h-[360px] w-full object-contain"
              loading="eager"
              fetchpriority="high"
            />
          </div>
        )
      }
    </header>

    <div class="panel max-w-3xl">
      <div class="prose max-w-none">
        <slot />
      </div>
    </div>

    {
      relatedPosts.length > 0 ? (
        <section class="mt-14 reveal">
          <div class="mb-5">
            <span class="pill">{t('relatedPostsTitle')}</span>
          </div>
          <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
            {relatedPosts.map((relatedPost) => (
              <BlogPostCard post={relatedPost} lang={lang} />
            ))}
          </div>
        </section>
      ) : null
    }
  </article>
</BaseLayout>
