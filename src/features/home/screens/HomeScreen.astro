---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';
import { ArrowRight, BookOpenText } from 'lucide-react';
import { type LanguageCode, useTranslations } from '@/i18n/ui';
import { formatDate } from '@/lib/utils';

type WritingPreview = {
  slug: string;
  title: string;
  description?: string;
  pubDate: Date;
  heroImage?: ImageMetadata;
  heroImageAlt?: string;
};

export type Props = {
  lang: LanguageCode;
  writingPreviews: Array<WritingPreview>;
};

const { lang, writingPreviews } = Astro.props;
const t = useTranslations(lang, 'homePage');

const aboutParagraphs = t('aboutSummary').split('\n\n').filter(Boolean);
const quickFacts = [
  {
    label: t('quickFact1Label'),
    value: t('quickFact1Value'),
  },
  {
    label: t('quickFact2Label'),
    value: t('quickFact2Value'),
  },
  {
    label: t('quickFact3Label'),
    value: t('quickFact3Value'),
  },
  {
    label: t('quickFact4Label'),
    value: t('quickFact4Value'),
  },
].filter((fact) => fact.label && fact.value);
---

<section class="content-shell page-intro">
  <h1 class="headline-display">{t('heroHeadline')}</h1>
  <p class="lede">{t('heroSubheadline')}</p>
  <p
    class="mt-4 max-w-3xl text-base leading-relaxed text-muted-foreground md:text-lg"
  >
    {t('heroSupporting')}
  </p>

  <div class="mt-8 flex flex-wrap gap-3">
    <a
      href="/blog"
      class="inline-flex items-center gap-2 rounded-xl bg-primary px-5 py-2.5 text-sm font-semibold text-primary-foreground shadow-md hover:bg-primary/90"
    >
      <BookOpenText class="size-4" />
      {t('heroPrimaryCta')}
    </a>
    <a
      href="/resume"
      class="inline-flex items-center gap-2 rounded-xl border border-border bg-card/80 px-5 py-2.5 text-sm font-semibold text-foreground hover:bg-muted"
    >
      {t('heroSecondaryCta')}
      <ArrowRight class="size-4" />
    </a>
  </div>
</section>

<section class="content-shell grid gap-6 lg:grid-cols-[1.6fr_1fr] reveal">
  <article class="panel space-y-4">
    <span class="pill">{t('aboutTitle')}</span>
    {
      aboutParagraphs.map((paragraph) => (
        <p class="leading-relaxed text-muted-foreground">{paragraph}</p>
      ))
    }
  </article>

  <aside class="panel space-y-4">
    <h2 class="section-title text-xl">{t('quickFactsTitle')}</h2>
    <dl class="space-y-4">
      {
        quickFacts.map((fact) => (
          <div>
            <dt class="text-[0.67rem] uppercase tracking-[0.2em] text-muted-foreground">
              {fact.label}
            </dt>
            <dd class="mt-1 text-sm leading-relaxed text-foreground/95">
              {fact.value}
            </dd>
          </div>
        ))
      }
    </dl>
  </aside>
</section>

<hr class="content-shell soft-divider" />

<section class="content-shell reveal">
  <div class="flex flex-wrap items-end justify-between gap-4">
    <div>
      <span class="pill">{t('writingTitle')}</span>
      <h2 class="section-title mt-3">{t('writingSubtitle')}</h2>
    </div>
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-sm font-semibold text-primary hover:text-primary/80"
    >
      {t('writingCtaLabel')}
      <ArrowRight class="size-4" />
    </a>
  </div>

  {
    writingPreviews.length > 0 ? (
      <div class="mt-7 grid gap-5 md:grid-cols-2 xl:grid-cols-3">
        {writingPreviews.map((post) => {
          const postUrl = `/blog/${post.slug}`;
          return (
            <article
              class="panel flex h-full flex-col gap-4 p-0"
              key={post.slug}
            >
              {post.heroImage ? (
                <a href={postUrl} class="block overflow-hidden rounded-t-2xl">
                  <Image
                    src={post.heroImage}
                    alt={post.heroImageAlt ?? post.title}
                    width={760}
                    height={420}
                    class="h-48 w-full object-cover transition-transform duration-400 hover:scale-105"
                    loading="lazy"
                    decoding="async"
                  />
                </a>
              ) : null}

              <div class="space-y-3 px-5 pb-5 pt-1">
                <p class="text-xs uppercase tracking-[0.12em] text-muted-foreground">
                  {formatDate(post.pubDate, lang)}
                </p>
                <h3 class="text-xl font-semibold leading-tight">
                  <a href={postUrl} class="hover:text-primary">
                    {post.title}
                  </a>
                </h3>
                {post.description && (
                  <p class="text-sm leading-relaxed text-muted-foreground">
                    {post.description}
                  </p>
                )}
                <a
                  href={postUrl}
                  class="inline-flex items-center gap-1.5 text-sm font-semibold text-primary"
                >
                  {t('writingReadMoreLabel')}
                  <ArrowRight class="size-4" />
                </a>
              </div>
            </article>
          );
        })}
      </div>
    ) : (
      <div class="panel mt-7 text-muted-foreground">
        {t('writingEmptyState')}
      </div>
    )
  }
</section>
